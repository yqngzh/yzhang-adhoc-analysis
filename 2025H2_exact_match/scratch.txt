nir_hard_negs_tm_so: ${matching.default} {
  owners: ["#search-matching", "@mcastanos"]
  description: "SO: NIR with Harder Negatives and TM data (based on entity_title_so)"
  semrel_config {
        relevance_threshold: 0.31
        shop_score_threshold: 0.7
        tfserving:${semrel.tfserving.semrel-serve-v2}
        ruleset: ["GlobalThresholdRule"]
  }
  dynamic_ir_config: ${core-matching.common.dynamic_ir_config} {
    blending_backend: seldon
    blending_modelset:  ${services.blender_seldon.search_blender_no_borda}
  }
  lexical_engine: ${matching.default.lexical_engine} {
    should_limit_solr_candidates: true
    enable_gqi: true
  }
  preretrieval: ${core-matching.common.preretrieval} {
    ann_feature_set: "nir-perso-lite"
  }
  ann: ${core-matching.common.ann} {
    candidate_source: ann
    config: {
      ann_ensemble: {
        seldon: ${services.ann_seldon.ann_ensemble_nir_plite_hard_negs_tm}
      }
    }
  }
  xwalk: ${core-matching.default.xwalk} {
    xwalk_candidate_source: disabled
  }
  xml: ${core-matching.common.xml} {
    request_config {
      k: 400,
      beam_size: 40,
      threshold: 0.0,
      pp: "sigmoid",
      multiterm_predict: "True"
    }
    xml_http_service: ${services.xml.xml_v2_multiterm.http}
  }
  query_entity {
    query_entity: cached
      dataset: smu_query_entity_extraction_v2
      memcached {
        memcached_enabled: true
        ttl: 12 hours
    }
  }
}